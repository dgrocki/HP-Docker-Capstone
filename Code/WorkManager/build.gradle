
/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Groovy project to get you started.
 * For more details take a look at the Groovy Quickstart chapter in the Gradle
 * user guide available at https://docs.gradle.org/4.10.2/userguide/tutorial_groovy_projects.html
 */

plugins {
    // Apply the groovy plugin to add support for Groovy
    id 'groovy'
	id 'java'
	id 'application'
	id 'com.github.johnrengelman.shadow' version '4.0.3'
	id 'maven'
	
}

apply plugin: 'jacoco'

application {
	mainClassName = 'com.hp.pwp.capstone.WorkManager'
}
dependencies {
    // Use the latest Groovy version for building this library
    compile 'org.codehaus.groovy:groovy-all:2.4.15'

    // Use the awesome Spock testing and specification framework
    testCompile 'org.spockframework:spock-core:1.1-groovy-2.4'
   compile group: 'com.surftools', name: 'BeanstalkClient' , version: '1.4.6' 
   compile 'com.basho.riak:riak-client:2.1.1'
   compile "org.slf4j:slf4j-simple:1.7.9"
   compile 'org.codehaus.gpars:gpars:1.2.0'
   compile group: 'org.eclipse.jetty', name: 'jetty-server', version: '9.4.15.v20190215'
   compile group: 'org.eclipse.jetty', name: 'jetty-servlet', version: '9.4.15.v20190215'
   compile group: 'org.eclipse.jetty.websocket', name: 'websocket-api', version: '9.4.15.v20190215'
   compile group: 'org.eclipse.jetty.websocket', name: 'websocket-server', version: '9.4.15.v20190215'
   implementation 'com.google.code.gson:gson:2.8.5' 
}

// In this section you declare where to find the dependencies of your project
repositories {
    // Use jcenter for resolving your dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
    maven{
    	url 'https://mvnrepository.com/artifact/com.surftools/BeanstlkdClient'
	url 'http://repo.maven.apache.org/maven2'	    
	url 'https://mvnrepository.com/artifact/com.basho.riak/riak-client'
	url "http://repo2.maven.org/maven2/"
	}
    mavenCentral()
}

jar {
	manifest {
		attributes "Main-Class": "com.hp.pwp.capstone.WorkManager" ;
	}
}

task uberjar(type: Jar, dependsOn: [':compileJava', ':compileGroovy', 'compileSourceSetGroovy']) {
    from files(sourceSets.main.output.classesDir)
    from configurations.runtime.asFileTree.files.collect { zipTree(it) }

    manifest {
        attributes 'Main-Class': 'com.hp.pwp.capstone.WorkManager'
    }
}

task buildImage(type:Exec) {
    commandLine 'docker', 'build', '-t', 'work-manager', '.'
}

//task runImage(type:Exec) {
//    commandLine 'docker', 'run', '-i', 'latest'
//}


//build.finalizedBy(buildImage)
//build.finalizedBy(runImage)


